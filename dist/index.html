<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fabric</title>
    <script src="./fabric.min.js"></script>
    <style>
      body {
        display: flex;
      }
      canvas {
        border: 1px solid #2c63ff;
      }
      textarea {
        width: 200px;
        height: 126px;
        margin-left: 20px;
        font-size: 30px;
        font-family: "Comic Sans";
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="800" height="800"></canvas>
    <textarea id="textarea"></textarea>
    <!-- <div id="textarea-wrap"></div> -->
    <script>
      // fabric.disableStyleCopyPaste = true
      // const canvas = new fabric.StaticCanvas("canvas");
      const canvas = new fabric.Canvas("canvas");

      // 正方形
      const rect = new fabric.Rect({
        top: 188,
        left: 45,
        width: 65,
        height: 65,
        fill: "#2c63ff",
      });
      canvas.add(rect);

      // 添加文字
      // const text = new fabric.Text('hello world', { left: 100, top: 100 });
      // canvas.add(text);

      const O2TextStyle = { fontWeight: "bold", fill: "#ffffff" };

      // 添加可编辑文字
      const duckText = new fabric.IText(
        "\u004F2 Lab\nSuperlin🦆🦆\n这里是深圳",
        {
          fontFamily: "Comic Sans",
          top: 200,
          left: 50,
          styles: {
            0: {
              0: O2TextStyle,
              1: O2TextStyle,
            },
          },
          // direction: 'rtl',
          // hasControls: false,
          // hiddenTextareaContainer: document.querySelector('#textarea-wrap')
        }
      );
      canvas.add(duckText);

      const helloText = new fabric.IText("hello, fabric", {
        fontFamily: "Comic Sans",
        top: 80,
        left: 50,
      });
      canvas.add(helloText);

      const zhText = new fabric.IText("你好\n这里是深圳", {
        fontFamily: "Comic Sans",
        top: 400,
        left: 50,
      });
      canvas.add(zhText);

      // 添加不可编辑文字
      //  const uneditableText = new fabric.IText("It's uneditable", {
      //     width: 500,
      //     fontFamily: 'Comic Sans',
      //     editable: false,
      //     // direction: 'rtl',
      // });
      // canvas.add(uneditableText);

      // 添加 textbox
      const textbox = new fabric.Textbox(
        "This lib is free for everyone.\nSome things are not.\nPeople behind FabricJS acknowledge that Black people have to fight for basic rights, against systemic racism, unequal opportunities and injustice across the 🌎.\nWe know this is wrong and we are 💔. 💪🏽💪🏾💪🏿!",
        {
          fontFamily: "Comic Sans",
          width: 460,
          top: 550,
          left: 50,
          fontSize: 16,
          splitByGrapheme: true,
        }
      );
      canvas.add(textbox);
    </script>
    <script>
      // 监听单个图层的事件
      duckText.on("selection:changed", function (options) {
        console.log("[duckText] selection:changed: ", options);
      });

      // 监听所有文本选区变化事件
      canvas.on("text:selection:changed", function (options) {
        // console.log('[canvas] text:selection:changed: ', options);
      });
    </script>
    <script>
      const textarea = document.getElementById("textarea");

      // textarea.value = 'A \uD87E\uDC04 Z'
      textarea.value = "O2 Lab\nSuperlin 🦆🦆\n这里是深圳";

      /**
       * 触发条件是 textarea 是失去焦点
       */
      textarea.addEventListener("change", function (e) {
        console.log("[textarea] change: ", e.target.value);
      });

      /**
       * 触发顺序 paste -> input
       */
      textarea.addEventListener("input", function (e) {
        console.log("[textarea] input: ", e.target.value);
      });
      textarea.addEventListener("paste", function (e) {
        console.log("[textarea] paste: ", e);
      });
    </script>
  </body>
</html>
